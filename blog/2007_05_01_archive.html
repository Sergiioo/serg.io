<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<!--

Sergio Annecchiarico - thanks very much to:

Design by Free CSS Templates
http://www.freecsstemplates.org
Released for free under a Creative Commons Attribution 2.5 License

Modified by Sergio Annecchiarico - feel free to tweak some more if you like...

-->

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>serg.io: May 2007</title>
    <meta name="keywords" content="blog, java, annecchiarico, sergio annecchiarico" />
    <meta name="description" content="Sergio Annecchiarico's blog" />

    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="alternate" type="application/atom+xml" title="Atom" href="http://feeds.feedburner.com/Sergio" />
    <link rel="alternate" type="application/rss+xml" title="RSS" href="http://feeds.feedburner.com/Sergio" />
    <link rel="alternate" type="application/rdf+xml" title="RSS" href="http://feeds.feedburner.com/Sergio" />
    <link rel="stylesheet" href="http://serg.io/blog/blog.css" type="text/css" media="all" />
    
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="MSSmartTagsPreventParsing" content="true" />
<meta name="generator" content="Blogger" />
<link rel="icon" type="image/vnd.microsoft.icon" href="http://www.blogger.com/favicon.ico"/>
<link rel="alternate" type="application/atom+xml" title="serg.io - Atom" href="http://serg.io/blog/atom.xml" />
<link rel="alternate" type="application/rss+xml" title="serg.io - RSS" href="http://serg.io/blog/rss.xml" />
<link rel="service.post" type="application/atom+xml" title="serg.io - Atom" href="http://www.blogger.com/feeds/4414172998613045683/posts/default" />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://www.blogger.com/rsd.g?blogID=4414172998613045683" />
 <link rel="stylesheet" type="text/css" href="http://www.blogger.com/css/blog_controls.css"/> <link rel="stylesheet" type="text/css" href="http://www.blogger.com/dyn-css/authorization.css?targetBlogID=4414172998613045683&zx=8ff63df0-9f16-47df-8529-09a22b0afcaf"/><script type="text/javascript" src="http://www.blogger.com/js/backlink.js"></script>
<script type="text/javascript" src="http://www.blogger.com/js/backlink_control.js"></script>
<script type="text/javascript">var BL_backlinkURL = "http://www.blogger.com/dyn-js/backlink_count.js";var BL_blogId = "4414172998613045683";</script>

    
    <script src="http://www.google-analytics.com/urchin.js" type="text/javascript"></script>
    <script type="text/javascript">
        _uacct = "UA-1603713-1";
        urchinTracker();
    </script>
    
    <script type="text/javascript" src="http://www.google.com/jsapi?key=ABQIAAAAuIWsJ156A26oSIQ4J-tsFhRi6DQAIOh2wezzjKqD7VrrikLmVxTK-IW2dWfJ5Po3ux3pqnnkgOwYog"></script>
    <script type="text/javascript">

    google.load("feeds", "1");

    function initialize() {
      var feed = new google.feeds.Feed("http://www.google.com/reader/public/atom/user/00174624012215095220/state/com.google/broadcast");
      feed.load(function(result) {
        if (!result.error) {
          var container = document.getElementById("feed");
            for (var i = 0; i < result.feed.entries.length && i < 5; i++) {
              var entry = result.feed.entries[i];
              var li = document.createElement("li");
              var header = li.appendChild(document.createElement("h3"));
              var link = li.appendChild(document.createElement("a"));
              link.appendChild(document.createTextNode(entry.title));
              link.href = entry.link;
              link.target = "_blank";
              var auth = li.appendChild(document.createElement("h4"));
              auth.appendChild(document.createTextNode("posted by " + entry.author));
              var snippet = li.appendChild(document.createElement("p"));
              snippet.appendChild(document.createTextNode(entry.contentSnippet));
              container.appendChild(li);
           }
	}
      });
    }
    google.setOnLoadCallback(initialize);

    </script>
    
<!-- --><style type="text/css">@import url(http://www.blogger.com/css/navbar/classic.css);
div.b-mobile {display:none;}
</style>

</head>

<body><script type="text/javascript">
    function setAttributeOnload(object, attribute, val) {
      if(window.addEventListener) {
        window.addEventListener("load",
          function(){ object[attribute] = val; }, false);
      } else {
        window.attachEvent('onload', function(){ object[attribute] = val; });
      }
    }
  </script>
<iframe src="http://www.blogger.com/navbar.g?targetBlogID=4414172998613045683&amp;blogName=serg.io&amp;publishMode=PUBLISH_MODE_FTP&amp;navbarType=BLACK&amp;layoutType=CLASSIC&amp;homepageUrl=http%3A%2F%2Fserg.io%2Fblog%2F&amp;searchRoot=http%3A%2F%2Fblogsearch.google.com%2F" marginwidth="0" marginheight="0" scrolling="no" frameborder="0" height="30px" width="100%" id="navbar-iframe" title="Blogger Navigation and Search"></iframe>
<div></div>
<div id="wrapper">
<div id="header">
    <div id="logo">
        <h1><a href="http://serg.io/blog">serg.io</a></h1>
        <h2>wittering and <a href="#">blathering</a> on</h2>
    </div>
    <div id="menu">
        <ul>
            <li class="active"><a href="http://serg.io/blog">blog</a></li>
            <li><a href="http://serg.io/about.html">about</a></li>
        </ul>
    </div>
</div>

<div id="page">
<div id="content">
<div id="welcome">

<div id="twitter_div">
  <ul id="twitter_update_list"></ul>
    <span id="twitter-link">
      according to <a href="http://twitter.com/serg10">Twitter</a>
      <a href="http://feeds.feedburner.com/Twitter/Serg10"><img style="border: none; vertical-align: middle;" src="http://serg.io/blog/images/feed-icon-10x10.png" alt="subscribe to my twitter feed" title="subscribe to my twitter feed" /></a>
    </span>
</div>


<h2>Easy transactional DAO JUnit tests using Spring</h2><a name="9180535329988123917"></a>
<div class="blogPost">
    <div style="clear:both;"></div><p>This is nice quick win from the wizards at Spring.  It is all in the doco, but I thought it was worthy of a post as it is very elegant.  Unit testing a traditional DAO always gives the problem of what to do with test data that gets left in the database.  Even if individual developers have their own database schema that gets cleared down and set up each time your test suite runs, you can get problems with data from one test polluting the next.  In the worst case, your test cases start to depend on the order in which they're run.<br /><br />Spring provides an absurdly long named, but very handy superclass for your JUnit test cases: <code><a href="http://www.springframework.org/docs/api/org/springframework/test/AbstractTransactionalDataSourceSpringContextTests.html">AbstractTransactionalDataSourceSpringContextTests</a></code><br /><br />Writing your test cases in a subclass of this will mean that each case seamlessly runs in its own transaction.  Spring starts a transaction before the test case method is invoked, then rolls it back on completion (pass or fail).<br /><br />Here's an example:<br /><pre class="codeBlock"><br />package io.serg.dao;<br /> <br />import java.util.Collection;<br />import org.junit.Test;<br />import org.springframework.test.<br />    AbstractTransactionalDataSourceSpringContextTests;<br />import io.serg.Customer;<br /> <br />public class CustomerDaoTest extends <br />    AbstractTransactionalDataSourceSpringContextTests {<br /> <br />   private ICustomerDao customerDao;<br /> <br />   public void setCustomerDao(ICustomerDao customerDao) {<br />      this.customerDao = customerDao;<br />   }<br /> <br />   @Test<br />   public void testGetAllCustomers() {<br /> <br />      Collection<icustomer> customers = this.customerDao.getAllCustomers();<br />      assertNotNull(customers);<br />      assertFalse(customers.isEmpty());<br />   }<br />}<br /> <br /></pre><br />The bean config to get this to work is very simple:<br /><pre class="codeBlock"><br />&lt;bean id="customerDao" <br />   class="io.serg.dao.CustomerDao"&gt;<br /><br />  &lt;property name="dataSource" ref="dataSource"/&gt;<br />&lt;/bean&gt;<br /> <br />&lt;bean id="dataSource" <br />   class="org.apache.commons.dbcp.BasicDataSource"<br />   destroy-method="close"&gt;<br />   <br />  &lt;property name="driverClassName" value="${jdbc.driverClass}"/&gt;<br />  &lt;property name="url" value="${jdbc.url}"/&gt;<br />  &lt;property name="username" value="${jdbc.username}"/&gt;<br />  &lt;property name="password" value="${jdbc.password}"/&gt;<br />&lt;/bean&gt;<br /> <br />&lt;bean id="transactionManager" <br />   class="org.springframework.jdbc.//<br />   datasource.DataSourceTransactionManager"&gt;<br /><br />  &lt;property name="dataSource" ref="dataSource"/&gt;<br />&lt;/bean&gt;<br /> <br /></pre><br />Note that we're using Spring's <a href="http://www.springframework.org/docs/reference/beans.html#beans-factory-autowiring-modes-tbl">autowire by type</a> to inject the transaction manager into our unit test superclass.  Still don't know what my feelings are about autowiring - my inate fear of all things magical means I'm trying to resist, but it does seem very neat in small examples like this.<br /><br />Clearly this is a very simple example, but more complex interactions with the database can be tested in this way, including the case where you do actually want to commit a transaction part way through a unit test (see the javadocs for <code><a href="http://www.springframework.org/docs/api/org/springframework/test/AbstractTransactionalSpringContextTests.html">org.springframework.test.AbstractTransactionalSpringContextTests</a></code>, specifically the <code><a href="http://www.springframework.org/docs/api/org/springframework/test/AbstractTransactionalSpringContextTests.html#setComplete()">setComplete()</a></code> method and <code><a href="http://www.springframework.org/docs/api/org/springframework/test/AbstractTransactionalSpringContextTests.html#setDefaultRollback(boolean)">defaultRollback</a></code> property).<br /><br />This is a particularly sweet solution for the problem of unit testing your DAOs.  You don’t need a separate test database per developer and you can run these concurrently and let the RDBMS handle the traffic.  <br /><br />The principle argument against this technique is that you are still physically hitting the database so you are not just unit testing the DAO code.  But in all honesty, unless you are going to mock up your datasource and jdbc connection (very painful) there is little alternative.  In the real world, unless you go down the OR mapping route, your DAO and database are irrevicably linked.  Furthermore, Spring allows you to write very clean DAOs which do almost nothing beyond handle the interaction with a relational database, so what else is there to test anyway?<div style="clear:both; padding-bottom:0.25em"></div><p class="blogger-labels">Labels: <a rel='tag' href="http://serg.io/blog/labels/java.html">java</a>, <a rel='tag' href="http://serg.io/blog/labels/spring.html">spring</a>, <a rel='tag' href="http://serg.io/blog/labels/testing.html">testing</a></p>
    <div class="byline">
        <a href="http://serg.io/blog/2007/05/easy-transactional-dao-junit-tests.html" title="permanent link">#</a> posted by Sergio on Tuesday, May 15, 2007
        
            
            
                <a class="comment-link" href="http://serg.io/blog/2007/05/easy-transactional-dao-junit-tests.html#links"><span style="text-transform:lowercase">Links to this post</span></a>
            
         <span class="item-action"><a href="http://www.blogger.com/email-post.g?blogID=4414172998613045683&postID=9180535329988123917" title="Email Post"><img class="icon-action" alt="" src="http://www.blogger.com:80/img/icon18_email.gif" height="13" width="18"/></a></span><span class="item-control blog-admin pid-1245354090"><a style="border:none;" href="http://www.blogger.com/post-edit.g?blogID=4414172998613045683&postID=9180535329988123917" title="Edit Post"><img class="icon-action" alt="" src="http://www.blogger.com:80/img/icon18_edit_allbkg.gif" height="18" width="18"></a></span>
        <br/>
        <br/>
        <br/>
        <span style="text-align:right; display:block;">
subscribe by <a href="http://www.feedburner.com/fb/a/emailverifySubmit?feedId=1077454&amp;loc=en_US">email</a> or
<a href="http://feeds.feedburner.com/Sergio" rel="alternate" type="application/rss+xml">rss</a>&nbsp;<a href="http://feeds.feedburner.com/Sergio" rel="alternate" type="application/rss+xml"><img src="http://serg.io/blog/images/feed-icon-12x12.png" alt="subscribe to blog updates" style="vertical-align:middle;border:0"/></a>
        </span>
    </div>
</div>

<br/>
<hr/>
<br/>


</div>
<!-- end div#welcome -->

<!--div id="sample1" class="boxed">
    
    <h2>Sample One</h2>
    <ul>
        <li><a href="#">Ut semper vestibulum est</a></li>
        <li><a href="#">Vestibulum luctus venenatis </a></li>
        <li><a href="#">Etiam malesuada enim</a></li>
        <li><a href="#">Aenean elementum facilisis </a></li>
        
        <li><a href="#">Ut tincidunt elit vitae augue</a></li>
        <li><a href="#">Sed quis odio sagittis leo </a></li>
    </ul>
</div-->
<!-- end div#sample1 -->
<!--div id="sample2" class="boxed">
    <h2>Sample Two</h2>
    
    <p>Quisque dictum nisl risus, sagittis, rutrum id, and nibh:</p>
    <ul>
        <li><a href="#">Integer rutrum nisl in mi</a></li>
        <li><a href="#">Etiam malesuada enim</a></li>
        <li><a href="#">Aenean elementum facilisis </a></li>
    </ul>
</div-->

<!-- end div#sample2 -->
</div>
<!-- end div#content -->
<div id="sidebar">
    <ul>
        <li id="submenu">
            <h2>Archives</h2>
            <ul>
                <li><a href='http://serg.io/blog/2007_05_01_archive.html'>May 2007</a></li><li><a href='http://serg.io/blog/2007_08_01_archive.html'>August 2007</a></li><li><a href='http://serg.io/blog/2007_10_01_archive.html'>October 2007</a></li><li><a href='http://serg.io/blog/2007_11_01_archive.html'>November 2007</a></li><li><a href='http://serg.io/blog/2008_01_01_archive.html'>January 2008</a></li><li><a href='http://serg.io/blog/2008_08_01_archive.html'>August 2008</a></li>
                <!-- Link to the front page, from your archives -->
                <script type="text/javascript">if (location.href.indexOf("archive")!=-1) document.write("<li><strong><a href=\"http://serg.io/blog/\">Current Posts</a></strong></li>");</script> 
            </ul>
        </li>
        <!-- end li#submenu -->
        <li id="news">
            <h2>Blog posts I'm reading</h2>
            <ul id="feed">

            </ul>
        </li>
        <!-- end li#news -->
    </ul>
    
    <!--div class='adsense' style='text-align:center; padding: 0px 3px 0.5em 3px;'>
                        <script type="text/javascript"--><!--
                            google_ad_client="pub-9053212304658958";
                            google_ad_host="pub-1556223355139109";
                            google_ad_width=300;
                            google_ad_height=250;
                            google_ad_format="300x250_as";
                            google_ad_type="text";
                            google_color_border="F6F6F6";
                            google_color_bg="F6F6F6";
                            google_color_link="000000";
                            google_color_url="777777";
                            google_color_text="9E5205";
                            //-->
    <!--/script>
                        <script type="text/javascript" src="http://pagead2.googlesyndication.com/pagead/show_ads.js"></script>
                    </div-->  
                    
</div>
<!-- end div#sidebar -->

<div style="clear: both; height: 1px"></div>
</div>
<!-- end div#page -->
<div id="footer">
    <p id="legal">Copyright &copy; 2007 serg.io.  Thanks to <a href="http://www.freecsstemplates.org/">Free CSS Templates</a> for css design.</p>
    <p id="links"><a href="#">Privacy Policy</a> | <a href="#">Terms of Use</a> | <a href="http://feeds.feedburner.com/Sergio">Subscribe</a>&nbsp;<a href="http://feeds.feedburner.com/Sergio"><img style="border: none; vertical-align: middle;" src="images/feed-icon-12x12.png" alt="subscribe to blog updates" title="subscribe to blog updates" /></a></p>
<br/>
    <!-- In accordance to the Blogger terms of service, please leave this button somewhere on your blogger-powered page. Thanks! -->
    <p>
        <a href="http://www.blogger.com">
            <img width="88" height="31" src="http://buttons.blogger.com/bloggerbutton1.gif" border="0" alt="This page is powered by Blogger. Isn't yours?" />
        </a>
    </p>
<p>
<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/2.0/uk/">
<img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by-nc-sa/2.0/uk/88x31.png" />
</a>
<br />This work by 
<a xmlns:cc="http://creativecommons.org/ns#" href="http://serg.io" property="cc:attributionName" rel="cc:attributionURL">http://serg.io</a> is licensed under a 
<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/2.0/uk/">Creative Commons Attribution-Non-Commercial-Share Alike 2.0 UK: England & Wales License</a>.
</p>
</div>
<!-- end div#footer -->
</div>
<!-- end div#wrapper -->

<!-- twitter updates -->
<script type="text/javascript" src="http://twitter.com/javascripts/blogger.js"></script>
<script text="text/javascript" src="http://twitter.com/statuses/user_timeline/serg10.json?callback=twitterCallback2&count=1"></script>

</body>
</html>